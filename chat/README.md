# Chat UI

–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —á–∞—Ç–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ LLM —á–µ—Ä–µ–∑ vLLM –∏ llama.cpp –±—ç–∫–µ–Ω–¥—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–æ–≤** - –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å –∏ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–°—Ç—Ä–∏–º–∏–Ω–≥** - –æ—Ç–≤–µ—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Reasoning** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –º—ã—à–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ (–¥–ª—è –º–æ–¥–µ–ª–µ–π —Å `reasoning_content`)
- **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤** - –¥–∏–∞–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–∞–π–¥–±–∞—Ä–µ
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏** - temperature, max_tokens, top_p
- **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞** - OpenAI-style –¥–∏–∑–∞–π–Ω

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source venv-vllm/bin/activate

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ UI
python chat/app.py
```

–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–í—ã–±–µ—Ä–∏—Ç–µ –±—ç–∫–µ–Ω–¥** - vLLM –∏–ª–∏ llama.cpp –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º –º–µ–Ω—é
2. **–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å** - –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ –ø–∞–ø–∫–µ `models/`
3. **–î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–ø—É—Å–∫–∞** - –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω–µ—Ç –∑–µ–ª–µ–Ω—ã–º –∫–æ–≥–¥–∞ –±—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤
4. **–ù–∞—á–Ω–∏—Ç–µ —á–∞—Ç** - –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
chat/
‚îú‚îÄ‚îÄ app.py              # Flask —Å–µ—Ä–≤–µ—Ä –∏ API —Ä–æ—É—Ç—ã
‚îú‚îÄ‚îÄ backend_manager.py  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–º vLLM/llama.cpp
‚îú‚îÄ‚îÄ llm_client.py       # Streaming –∫–ª–∏–µ–Ω—Ç –¥–ª—è OpenAI-compatible API
‚îú‚îÄ‚îÄ chat_storage.py     # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ model_scanner.py    # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫ —Å –º–æ–¥–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ø–æ—Ä—Ç—ã, –ø—É—Ç–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
‚îú‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ style.css       # –°—Ç–∏–ª–∏ (—Ç–µ–º–Ω–∞—è —Ç–µ–º–∞)
‚îÇ   ‚îî‚îÄ‚îÄ app.js          # Frontend –ª–æ–≥–∏–∫–∞
‚îî‚îÄ‚îÄ templates/
    ‚îî‚îÄ‚îÄ index.html      # HTML —à–∞–±–ª–æ–Ω
```

## API Endpoints

### –ë—ç–∫–µ–Ω–¥—ã

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/backends` | –°–ø–∏—Å–æ–∫ –±—ç–∫–µ–Ω–¥–æ–≤ |
| GET | `/api/backends/status` | –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (–∑–∞–ø—É—â–µ–Ω/–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω) |
| POST | `/api/backends/start` | –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞ (SSE –ø—Ä–æ–≥—Ä–µ—Å—Å) |
| POST | `/api/backends/stop` | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±—ç–∫–µ–Ω–¥–∞ |

### –ú–æ–¥–µ–ª–∏

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/models` | –í—Å–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –±—ç–∫–µ–Ω–¥–æ–≤ |
| GET | `/api/models/<backend>` | –ú–æ–¥–µ–ª–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞ |

### –ß–∞—Ç

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/chat` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (SSE —Å—Ç—Ä–∏–º–∏–Ω–≥) |
| GET | `/api/chats` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ |
| POST | `/api/chats` | –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ |
| GET | `/api/chats/<id>` | –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Ç–∞ –ø–æ ID |
| PUT | `/api/chats/<id>` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞ |
| DELETE | `/api/chats/<id>` | –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞ |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `config.py`:

```python
# –ü–æ—Ä—Ç—ã –±—ç–∫–µ–Ω–¥–æ–≤
DEFAULT_VLLM_URL = "http://localhost:8000"
DEFAULT_LLAMACPP_URL = "http://localhost:8001"

# –ü–∞–ø–∫–∏ –º–æ–¥–µ–ª–µ–π
MODELS_DIR = "models"
VLLM_MODELS_SUBDIR = "hf"       # models/hf/
LLAMACPP_MODELS_SUBDIR = "gguf"  # models/gguf/

# –¢–∞–π–º–∞—É—Ç—ã
BACKEND_STARTUP_TIMEOUT = 120    # —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞
LLM_REQUEST_TIMEOUT = 300        # —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
DEFAULT_TEMPERATURE = 0.7
DEFAULT_MAX_TOKENS = 2048
DEFAULT_TOP_P = 0.9
```

## –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

- **–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤**: `.chat_history/` (JSON —Ñ–∞–π–ª—ã)
- **–õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–æ–≤**: `.backend_logs/` (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ª–æ–≥–∏)

–û–±–µ –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `.gitignore`.

## –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞

- üî¥ **–ö—Ä–∞—Å–Ω—ã–π** - –±—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω
- üü° **–ñ–µ–ª—Ç—ã–π** (–ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π) - –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- üü¢ **–ó–µ–ª–µ–Ω—ã–π** - –±—ç–∫–µ–Ω–¥ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ

## –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ Reasoning

–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `reasoning_content` (–Ω–∞–ø—Ä–∏–º–µ—Ä, Qwen —Å thinking mode), –æ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–º –±–ª–æ–∫–µ –Ω–∞–¥ –æ—Ç–≤–µ—Ç–æ–º:

- –í–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–ª–æ–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è
- –ú–æ–∂–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å/—Å–≤–µ—Ä–Ω—É—Ç—å –∫–ª–∏–∫–æ–º –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫

## Troubleshooting

### –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ vLLM/llama.cpp —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –≤ `.backend_logs/`
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ—Ä—Ç—ã 8000/8001 —Å–≤–æ–±–æ–¥–Ω—ã

### –ú–æ–¥–µ–ª–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫:
   - vLLM –º–æ–¥–µ–ª–∏: `models/hf/<model_name>/config.json`
   - llama.cpp –º–æ–¥–µ–ª–∏: `models/gguf/*.gguf`

### –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

1. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞–Ω–µ—Ç –∑–µ–ª–µ–Ω—ã–º
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±—ç–∫–µ–Ω–¥ —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã)
